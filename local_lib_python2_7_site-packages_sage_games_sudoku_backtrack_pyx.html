


<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    
    <meta http-equiv="X-UA-Compatible" content="IE=emulateIE7" />
    <title>Coverage for local/lib/python2.7/site-packages/sage/games/sudoku_backtrack.pyx: 99%</title>
    <link rel="stylesheet" href="style.css" type="text/css">
    
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="jquery.hotkeys.js"></script>
    <script type="text/javascript" src="jquery.isonscreen.js"></script>
    <script type="text/javascript" src="coverage_html.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(coverage.pyfile_ready);
    </script>
</head>
<body class="pyfile">

<div id="header">
    <div class="content">
        <h1>Coverage for <b>local/lib/python2.7/site-packages/sage/games/sudoku_backtrack.pyx</b> :
            <span class="pc_cov">99%</span>
        </h1>

        <img id="keyboard_icon" src="keybd_closed.png" alt="Show keyboard shortcuts" />

        <h2 class="stats">
            92 statements &nbsp;
            <span class="run hide_run shortkey_r button_toggle_run">91 run</span>
            <span class="mis shortkey_m button_toggle_mis">1 missing</span>
            <span class="exc shortkey_x button_toggle_exc">0 excluded</span>

            
        </h2>
    </div>
</div>

<div class="help_panel">
    <img id="panel_icon" src="keybd_open.png" alt="Hide keyboard shortcuts" />
    <p class="legend">Hot-keys on this page</p>
    <div>
    <p class="keyhelp">
        <span class="key">r</span>
        <span class="key">m</span>
        <span class="key">x</span>
        <span class="key">p</span> &nbsp; toggle line displays
    </p>
    <p class="keyhelp">
        <span class="key">j</span>
        <span class="key">k</span> &nbsp; next/prev highlighted chunk
    </p>
    <p class="keyhelp">
        <span class="key">0</span> &nbsp; (zero) top of page
    </p>
    <p class="keyhelp">
        <span class="key">1</span> &nbsp; (one) first highlighted chunk
    </p>
    </div>
</div>

<div id="source">
    <table>
        <tr>
            <td class="linenos">
<p id="n1" class="pln"><a href="#n1">1</a></p>
<p id="n2" class="pln"><a href="#n2">2</a></p>
<p id="n3" class="pln"><a href="#n3">3</a></p>
<p id="n4" class="pln"><a href="#n4">4</a></p>
<p id="n5" class="pln"><a href="#n5">5</a></p>
<p id="n6" class="pln"><a href="#n6">6</a></p>
<p id="n7" class="pln"><a href="#n7">7</a></p>
<p id="n8" class="pln"><a href="#n8">8</a></p>
<p id="n9" class="stm mis"><a href="#n9">9</a></p>
<p id="n10" class="pln"><a href="#n10">10</a></p>
<p id="n11" class="pln"><a href="#n11">11</a></p>
<p id="n12" class="pln"><a href="#n12">12</a></p>
<p id="n13" class="pln"><a href="#n13">13</a></p>
<p id="n14" class="pln"><a href="#n14">14</a></p>
<p id="n15" class="pln"><a href="#n15">15</a></p>
<p id="n16" class="pln"><a href="#n16">16</a></p>
<p id="n17" class="pln"><a href="#n17">17</a></p>
<p id="n18" class="pln"><a href="#n18">18</a></p>
<p id="n19" class="pln"><a href="#n19">19</a></p>
<p id="n20" class="pln"><a href="#n20">20</a></p>
<p id="n21" class="pln"><a href="#n21">21</a></p>
<p id="n22" class="pln"><a href="#n22">22</a></p>
<p id="n23" class="pln"><a href="#n23">23</a></p>
<p id="n24" class="pln"><a href="#n24">24</a></p>
<p id="n25" class="pln"><a href="#n25">25</a></p>
<p id="n26" class="pln"><a href="#n26">26</a></p>
<p id="n27" class="pln"><a href="#n27">27</a></p>
<p id="n28" class="pln"><a href="#n28">28</a></p>
<p id="n29" class="pln"><a href="#n29">29</a></p>
<p id="n30" class="pln"><a href="#n30">30</a></p>
<p id="n31" class="pln"><a href="#n31">31</a></p>
<p id="n32" class="pln"><a href="#n32">32</a></p>
<p id="n33" class="pln"><a href="#n33">33</a></p>
<p id="n34" class="pln"><a href="#n34">34</a></p>
<p id="n35" class="pln"><a href="#n35">35</a></p>
<p id="n36" class="pln"><a href="#n36">36</a></p>
<p id="n37" class="pln"><a href="#n37">37</a></p>
<p id="n38" class="pln"><a href="#n38">38</a></p>
<p id="n39" class="pln"><a href="#n39">39</a></p>
<p id="n40" class="pln"><a href="#n40">40</a></p>
<p id="n41" class="pln"><a href="#n41">41</a></p>
<p id="n42" class="pln"><a href="#n42">42</a></p>
<p id="n43" class="pln"><a href="#n43">43</a></p>
<p id="n44" class="pln"><a href="#n44">44</a></p>
<p id="n45" class="pln"><a href="#n45">45</a></p>
<p id="n46" class="pln"><a href="#n46">46</a></p>
<p id="n47" class="pln"><a href="#n47">47</a></p>
<p id="n48" class="pln"><a href="#n48">48</a></p>
<p id="n49" class="pln"><a href="#n49">49</a></p>
<p id="n50" class="pln"><a href="#n50">50</a></p>
<p id="n51" class="pln"><a href="#n51">51</a></p>
<p id="n52" class="pln"><a href="#n52">52</a></p>
<p id="n53" class="pln"><a href="#n53">53</a></p>
<p id="n54" class="pln"><a href="#n54">54</a></p>
<p id="n55" class="pln"><a href="#n55">55</a></p>
<p id="n56" class="pln"><a href="#n56">56</a></p>
<p id="n57" class="pln"><a href="#n57">57</a></p>
<p id="n58" class="pln"><a href="#n58">58</a></p>
<p id="n59" class="pln"><a href="#n59">59</a></p>
<p id="n60" class="pln"><a href="#n60">60</a></p>
<p id="n61" class="pln"><a href="#n61">61</a></p>
<p id="n62" class="pln"><a href="#n62">62</a></p>
<p id="n63" class="pln"><a href="#n63">63</a></p>
<p id="n64" class="pln"><a href="#n64">64</a></p>
<p id="n65" class="stm run hide_run"><a href="#n65">65</a></p>
<p id="n66" class="stm run hide_run"><a href="#n66">66</a></p>
<p id="n67" class="stm run hide_run"><a href="#n67">67</a></p>
<p id="n68" class="pln"><a href="#n68">68</a></p>
<p id="n69" class="pln"><a href="#n69">69</a></p>
<p id="n70" class="pln"><a href="#n70">70</a></p>
<p id="n71" class="stm run hide_run"><a href="#n71">71</a></p>
<p id="n72" class="pln"><a href="#n72">72</a></p>
<p id="n73" class="pln"><a href="#n73">73</a></p>
<p id="n74" class="stm run hide_run"><a href="#n74">74</a></p>
<p id="n75" class="stm run hide_run"><a href="#n75">75</a></p>
<p id="n76" class="stm run hide_run"><a href="#n76">76</a></p>
<p id="n77" class="stm run hide_run"><a href="#n77">77</a></p>
<p id="n78" class="stm run hide_run"><a href="#n78">78</a></p>
<p id="n79" class="stm run hide_run"><a href="#n79">79</a></p>
<p id="n80" class="pln"><a href="#n80">80</a></p>
<p id="n81" class="stm run hide_run"><a href="#n81">81</a></p>
<p id="n82" class="stm run hide_run"><a href="#n82">82</a></p>
<p id="n83" class="stm run hide_run"><a href="#n83">83</a></p>
<p id="n84" class="stm run hide_run"><a href="#n84">84</a></p>
<p id="n85" class="stm run hide_run"><a href="#n85">85</a></p>
<p id="n86" class="stm run hide_run"><a href="#n86">86</a></p>
<p id="n87" class="pln"><a href="#n87">87</a></p>
<p id="n88" class="stm run hide_run"><a href="#n88">88</a></p>
<p id="n89" class="stm run hide_run"><a href="#n89">89</a></p>
<p id="n90" class="stm run hide_run"><a href="#n90">90</a></p>
<p id="n91" class="stm run hide_run"><a href="#n91">91</a></p>
<p id="n92" class="pln"><a href="#n92">92</a></p>
<p id="n93" class="stm run hide_run"><a href="#n93">93</a></p>
<p id="n94" class="stm run hide_run"><a href="#n94">94</a></p>
<p id="n95" class="stm run hide_run"><a href="#n95">95</a></p>
<p id="n96" class="stm run hide_run"><a href="#n96">96</a></p>
<p id="n97" class="pln"><a href="#n97">97</a></p>
<p id="n98" class="pln"><a href="#n98">98</a></p>
<p id="n99" class="pln"><a href="#n99">99</a></p>
<p id="n100" class="pln"><a href="#n100">100</a></p>
<p id="n101" class="stm run hide_run"><a href="#n101">101</a></p>
<p id="n102" class="stm run hide_run"><a href="#n102">102</a></p>
<p id="n103" class="stm run hide_run"><a href="#n103">103</a></p>
<p id="n104" class="stm run hide_run"><a href="#n104">104</a></p>
<p id="n105" class="stm run hide_run"><a href="#n105">105</a></p>
<p id="n106" class="pln"><a href="#n106">106</a></p>
<p id="n107" class="pln"><a href="#n107">107</a></p>
<p id="n108" class="pln"><a href="#n108">108</a></p>
<p id="n109" class="pln"><a href="#n109">109</a></p>
<p id="n110" class="stm run hide_run"><a href="#n110">110</a></p>
<p id="n111" class="pln"><a href="#n111">111</a></p>
<p id="n112" class="pln"><a href="#n112">112</a></p>
<p id="n113" class="stm run hide_run"><a href="#n113">113</a></p>
<p id="n114" class="stm run hide_run"><a href="#n114">114</a></p>
<p id="n115" class="pln"><a href="#n115">115</a></p>
<p id="n116" class="stm run hide_run"><a href="#n116">116</a></p>
<p id="n117" class="stm run hide_run"><a href="#n117">117</a></p>
<p id="n118" class="stm run hide_run"><a href="#n118">118</a></p>
<p id="n119" class="stm run hide_run"><a href="#n119">119</a></p>
<p id="n120" class="pln"><a href="#n120">120</a></p>
<p id="n121" class="pln"><a href="#n121">121</a></p>
<p id="n122" class="stm run hide_run"><a href="#n122">122</a></p>
<p id="n123" class="stm run hide_run"><a href="#n123">123</a></p>
<p id="n124" class="stm run hide_run"><a href="#n124">124</a></p>
<p id="n125" class="stm run hide_run"><a href="#n125">125</a></p>
<p id="n126" class="stm run hide_run"><a href="#n126">126</a></p>
<p id="n127" class="pln"><a href="#n127">127</a></p>
<p id="n128" class="pln"><a href="#n128">128</a></p>
<p id="n129" class="stm run hide_run"><a href="#n129">129</a></p>
<p id="n130" class="stm run hide_run"><a href="#n130">130</a></p>
<p id="n131" class="stm run hide_run"><a href="#n131">131</a></p>
<p id="n132" class="stm run hide_run"><a href="#n132">132</a></p>
<p id="n133" class="stm run hide_run"><a href="#n133">133</a></p>
<p id="n134" class="stm run hide_run"><a href="#n134">134</a></p>
<p id="n135" class="pln"><a href="#n135">135</a></p>
<p id="n136" class="stm run hide_run"><a href="#n136">136</a></p>
<p id="n137" class="stm run hide_run"><a href="#n137">137</a></p>
<p id="n138" class="stm run hide_run"><a href="#n138">138</a></p>
<p id="n139" class="stm run hide_run"><a href="#n139">139</a></p>
<p id="n140" class="stm run hide_run"><a href="#n140">140</a></p>
<p id="n141" class="stm run hide_run"><a href="#n141">141</a></p>
<p id="n142" class="stm run hide_run"><a href="#n142">142</a></p>
<p id="n143" class="stm run hide_run"><a href="#n143">143</a></p>
<p id="n144" class="pln"><a href="#n144">144</a></p>
<p id="n145" class="stm run hide_run"><a href="#n145">145</a></p>
<p id="n146" class="stm run hide_run"><a href="#n146">146</a></p>
<p id="n147" class="stm run hide_run"><a href="#n147">147</a></p>
<p id="n148" class="stm run hide_run"><a href="#n148">148</a></p>
<p id="n149" class="pln"><a href="#n149">149</a></p>
<p id="n150" class="stm run hide_run"><a href="#n150">150</a></p>
<p id="n151" class="pln"><a href="#n151">151</a></p>
<p id="n152" class="stm run hide_run"><a href="#n152">152</a></p>
<p id="n153" class="pln"><a href="#n153">153</a></p>
<p id="n154" class="pln"><a href="#n154">154</a></p>
<p id="n155" class="pln"><a href="#n155">155</a></p>
<p id="n156" class="pln"><a href="#n156">156</a></p>
<p id="n157" class="stm run hide_run"><a href="#n157">157</a></p>
<p id="n158" class="stm run hide_run"><a href="#n158">158</a></p>
<p id="n159" class="stm run hide_run"><a href="#n159">159</a></p>
<p id="n160" class="stm run hide_run"><a href="#n160">160</a></p>
<p id="n161" class="stm run hide_run"><a href="#n161">161</a></p>
<p id="n162" class="stm run hide_run"><a href="#n162">162</a></p>
<p id="n163" class="stm run hide_run"><a href="#n163">163</a></p>
<p id="n164" class="stm run hide_run"><a href="#n164">164</a></p>
<p id="n165" class="stm run hide_run"><a href="#n165">165</a></p>
<p id="n166" class="stm run hide_run"><a href="#n166">166</a></p>
<p id="n167" class="stm run hide_run"><a href="#n167">167</a></p>
<p id="n168" class="stm run hide_run"><a href="#n168">168</a></p>
<p id="n169" class="stm run hide_run"><a href="#n169">169</a></p>
<p id="n170" class="stm run hide_run"><a href="#n170">170</a></p>
<p id="n171" class="stm run hide_run"><a href="#n171">171</a></p>
<p id="n172" class="stm run hide_run"><a href="#n172">172</a></p>
<p id="n173" class="stm run hide_run"><a href="#n173">173</a></p>
<p id="n174" class="stm run hide_run"><a href="#n174">174</a></p>
<p id="n175" class="stm run hide_run"><a href="#n175">175</a></p>
<p id="n176" class="stm run hide_run"><a href="#n176">176</a></p>
<p id="n177" class="stm run hide_run"><a href="#n177">177</a></p>
<p id="n178" class="stm run hide_run"><a href="#n178">178</a></p>
<p id="n179" class="stm run hide_run"><a href="#n179">179</a></p>
<p id="n180" class="stm run hide_run"><a href="#n180">180</a></p>
<p id="n181" class="stm run hide_run"><a href="#n181">181</a></p>
<p id="n182" class="stm run hide_run"><a href="#n182">182</a></p>
<p id="n183" class="pln"><a href="#n183">183</a></p>
<p id="n184" class="pln"><a href="#n184">184</a></p>
<p id="n185" class="stm run hide_run"><a href="#n185">185</a></p>
<p id="n186" class="pln"><a href="#n186">186</a></p>
<p id="n187" class="stm run hide_run"><a href="#n187">187</a></p>
<p id="n188" class="stm run hide_run"><a href="#n188">188</a></p>
<p id="n189" class="stm run hide_run"><a href="#n189">189</a></p>

            </td>
            <td class="text">
<p id="t1" class="pln"><span class="txt">r"""</span><span class="strut">&nbsp;</span></p>
<p id="t2" class="pln"><span class="txt">This module contains Cython code for a backtracking algorithm to solve Sudoku puzzles.</span><span class="strut">&nbsp;</span></p>
<p id="t3" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t4" class="pln"><span class="txt">Once Cython implements closures and the ``yield`` keyword is possible, this can be moved into the ``sage.games.sudoku`` module, as part of the ``Sudoku.backtrack`` method, and this module can be banned.</span><span class="strut">&nbsp;</span></p>
<p id="t5" class="pln"><span class="txt">"""</span><span class="strut">&nbsp;</span></p>
<p id="t6" class="pln"><span class="txt">from __future__ import print_function</span><span class="strut">&nbsp;</span></p>
<p id="t7" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t8" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t9" class="stm mis"><span class="txt">def backtrack_all(n, puzzle):</span><span class="strut">&nbsp;</span></p>
<p id="t10" class="pln"><span class="txt">    r"""</span><span class="strut">&nbsp;</span></p>
<p id="t11" class="pln"><span class="txt">    A routine to compute all the solutions to a Sudoku puzzle.</span><span class="strut">&nbsp;</span></p>
<p id="t12" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t13" class="pln"><span class="txt">    INPUT:</span><span class="strut">&nbsp;</span></p>
<p id="t14" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t15" class="pln"><span class="txt">        - ``n`` - the size of the puzzle, where the array is an `n^2\times n^2` grid</span><span class="strut">&nbsp;</span></p>
<p id="t16" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t17" class="pln"><span class="txt">        - ``puzzle`` - a list of the entries of the puzzle (1-based), in row-major order</span><span class="strut">&nbsp;</span></p>
<p id="t18" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t19" class="pln"><span class="txt">    OUTPUT:</span><span class="strut">&nbsp;</span></p>
<p id="t20" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t21" class="pln"><span class="txt">        A list of solutions, where each solution is a (1-based) list similar to ``puzzle``.</span><span class="strut">&nbsp;</span></p>
<p id="t22" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t23" class="pln"><span class="txt">    TESTS:</span><span class="strut">&nbsp;</span></p>
<p id="t24" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t25" class="pln"><span class="txt">    This is just a cursory test here, since eventually this code will move.</span><span class="strut">&nbsp;</span></p>
<p id="t26" class="pln"><span class="txt">    See the `backtrack` method of the `Sudoku` class in the</span><span class="strut">&nbsp;</span></p>
<p id="t27" class="pln"><span class="txt">    `sage.games.sudoku` module for more enlightening examples. ::</span><span class="strut">&nbsp;</span></p>
<p id="t28" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t29" class="pln"><span class="txt">        sage: from sage.games.sudoku_backtrack import backtrack_all</span><span class="strut">&nbsp;</span></p>
<p id="t30" class="pln"><span class="txt">        sage: c = [0, 0, 0, 0, 1, 0, 9, 0, 0, 8, 0, 0, 4, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 7, 0, 0, 3, 0, 0, 0,0, 0, 0, 0, 0, 0, 0, 2, 0, 4, 0, 0, 0, 0, 0, 0, 0, 5, 8, 0, 6, 0, 0, 0, 0, 1, 3, 0, 7, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 8, 0, 0, 0, 0, 0]</span><span class="strut">&nbsp;</span></p>
<p id="t31" class="pln"><span class="txt">        sage: print(backtrack_all(3, c))</span><span class="strut">&nbsp;</span></p>
<p id="t32" class="pln"><span class="txt">        [[6, 5, 4, 3, 1, 2, 9, 8, 7, 8, 3, 1, 4, 7, 9, 5, 2, 6, 2, 9, 7, 6, 8, 5, 4, 1, 3, 4, 7, 2, 5, 3, 8, 6, 9, 1, 3, 8, 5, 1, 9, 6, 2, 7, 4, 9, 1, 6, 7, 2, 4, 3, 5, 8, 5, 6, 8, 9, 4, 7, 1, 3, 2, 7, 4, 3, 2, 5, 1, 8, 6, 9, 1, 2, 9, 8, 6, 3, 7, 4, 5]]</span><span class="strut">&nbsp;</span></p>
<p id="t33" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t34" class="pln"><span class="txt">    ALGORITHM:</span><span class="strut">&nbsp;</span></p>
<p id="t35" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t36" class="pln"><span class="txt">    We traverse a search tree depth-first.  Each level of the tree corresponds to a location in the grid, listed in row-major order.  At each location we maintain a list of the symbols which may be used in that location as follows.</span><span class="strut">&nbsp;</span></p>
<p id="t37" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t38" class="pln"><span class="txt">    A location has "peers", which are the locations in the same row, column or box (sub-grid).  As symbols are chosen (or fixed initially) at a location, they become ineligible for use at a peer.  We track this in the ``available`` array where at each location each symbol has a count of how many times it has been made ineligible.  As this counter transitions between 0 and 1, the number of eligible symbols at a location is tracked in the ``card`` array.  When the number of eligible symbols at any location becomes 1, then we know that *must* be the symbol employed in that location.  This then allows us to further update the eligible symbols at the peers of that location.  When the number of the eligible symbols at any location becomes 0, then we know that we can prune the search tree.</span><span class="strut">&nbsp;</span></p>
<p id="t39" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t40" class="pln"><span class="txt">    So at each new level of the search tree, we propagate as many fixed symbols as we can, placing them into a two-ended queue (``fixed`` and ``fixed_symbol``) that we process until it is empty or we need to prune.  All this recording of ineligible symbols and numbers of eligible symbols has to be unwound as we backup the tree, though.</span><span class="strut">&nbsp;</span></p>
<p id="t41" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t42" class="pln"><span class="txt">    The notion of propagating singleton cells forward comes from an essay by Peter Norvig [sudoku:norvig]_.</span><span class="strut">&nbsp;</span></p>
<p id="t43" class="pln"><span class="txt">    """</span><span class="strut">&nbsp;</span></p>
<p id="t44" class="pln"><span class="txt">    cdef:</span><span class="strut">&nbsp;</span></p>
<p id="t45" class="pln"><span class="txt">        # Arrays sizes are n^4, and n^2, with 3n^2-2n-1 for second slot of peers, n = 4</span><span class="strut">&nbsp;</span></p>
<p id="t46" class="pln"><span class="txt">        int i, j, count, level, apeer</span><span class="strut">&nbsp;</span></p>
<p id="t47" class="pln"><span class="txt">        int nsquare, npeers, nboxes</span><span class="strut">&nbsp;</span></p>
<p id="t48" class="pln"><span class="txt">        int grid_row, grid_col, grid_corner</span><span class="strut">&nbsp;</span></p>
<p id="t49" class="pln"><span class="txt">        int peers[256][39]</span><span class="strut">&nbsp;</span></p>
<p id="t50" class="pln"><span class="txt">        int box[256]</span><span class="strut">&nbsp;</span></p>
<p id="t51" class="pln"><span class="txt">        int available[256][16]</span><span class="strut">&nbsp;</span></p>
<p id="t52" class="pln"><span class="txt">        int card[256]</span><span class="strut">&nbsp;</span></p>
<p id="t53" class="pln"><span class="txt">        int hint, symbol, abox</span><span class="strut">&nbsp;</span></p>
<p id="t54" class="pln"><span class="txt">        int feasible</span><span class="strut">&nbsp;</span></p>
<p id="t55" class="pln"><span class="txt">        int nfixed[256]</span><span class="strut">&nbsp;</span></p>
<p id="t56" class="pln"><span class="txt">        int fixed[256][256]</span><span class="strut">&nbsp;</span></p>
<p id="t57" class="pln"><span class="txt">        int fixed_symbol[256][256]</span><span class="strut">&nbsp;</span></p>
<p id="t58" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t59" class="pln"><span class="txt">        int process, asymbol, alevel, process_level, process_symbol</span><span class="strut">&nbsp;</span></p>
<p id="t60" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t61" class="pln"><span class="txt">    # sanity check on size (types)</span><span class="strut">&nbsp;</span></p>
<p id="t62" class="pln"><span class="txt">    # n is "base" dimension</span><span class="strut">&nbsp;</span></p>
<p id="t63" class="pln"><span class="txt">    # nsquare is size of a grid</span><span class="strut">&nbsp;</span></p>
<p id="t64" class="pln"><span class="txt">    # nboxes is total number of entries</span><span class="strut">&nbsp;</span></p>
<p id="t65" class="stm run hide_run"><span class="txt">    nsquare = n*n</span><span class="strut">&nbsp;</span></p>
<p id="t66" class="stm run hide_run"><span class="txt">    nboxes = nsquare * nsquare</span><span class="strut">&nbsp;</span></p>
<p id="t67" class="stm run hide_run"><span class="txt">    npeers = 3*n*n-2*n-1  # 2(n^2-1)+n^2-2n+1</span><span class="strut">&nbsp;</span></p>
<p id="t68" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t69" class="pln"><span class="txt">    # "Peers" of a box are boxes in the same column, row or grid</span><span class="strut">&nbsp;</span></p>
<p id="t70" class="pln"><span class="txt">    # Like the conflict graph when expressed as a graph coloring problem</span><span class="strut">&nbsp;</span></p>
<p id="t71" class="stm run hide_run"><span class="txt">    for level in range(nboxes):</span><span class="strut">&nbsp;</span></p>
<p id="t72" class="pln"><span class="txt">        # location as row and column in square</span><span class="strut">&nbsp;</span></p>
<p id="t73" class="pln"><span class="txt">        # grids are numbered similarly, in row-major order</span><span class="strut">&nbsp;</span></p>
<p id="t74" class="stm run hide_run"><span class="txt">        row = level // nsquare</span><span class="strut">&nbsp;</span></p>
<p id="t75" class="stm run hide_run"><span class="txt">        col = level %  nsquare</span><span class="strut">&nbsp;</span></p>
<p id="t76" class="stm run hide_run"><span class="txt">        grid_corner = (row - (row % n))*nsquare + (col - (col % n))</span><span class="strut">&nbsp;</span></p>
<p id="t77" class="stm run hide_run"><span class="txt">        grid_row = row // n</span><span class="strut">&nbsp;</span></p>
<p id="t78" class="stm run hide_run"><span class="txt">        grid_col = col // n</span><span class="strut">&nbsp;</span></p>
<p id="t79" class="stm run hide_run"><span class="txt">        count = -1</span><span class="strut">&nbsp;</span></p>
<p id="t80" class="pln"><span class="txt">        # Peers' levels in same grid, but not the box itself</span><span class="strut">&nbsp;</span></p>
<p id="t81" class="stm run hide_run"><span class="txt">        for i in range(n):</span><span class="strut">&nbsp;</span></p>
<p id="t82" class="stm run hide_run"><span class="txt">            for j in range(n):</span><span class="strut">&nbsp;</span></p>
<p id="t83" class="stm run hide_run"><span class="txt">                grid_level = grid_corner + i*nsquare + j</span><span class="strut">&nbsp;</span></p>
<p id="t84" class="stm run hide_run"><span class="txt">                if grid_level != level:</span><span class="strut">&nbsp;</span></p>
<p id="t85" class="stm run hide_run"><span class="txt">                    count += 1</span><span class="strut">&nbsp;</span></p>
<p id="t86" class="stm run hide_run"><span class="txt">                    peers[level][count] = grid_level</span><span class="strut">&nbsp;</span></p>
<p id="t87" class="pln"><span class="txt">        # Peers' levels in the same row, but not in grid</span><span class="strut">&nbsp;</span></p>
<p id="t88" class="stm run hide_run"><span class="txt">        for i in range(nsquare):</span><span class="strut">&nbsp;</span></p>
<p id="t89" class="stm run hide_run"><span class="txt">            if (i // 3 != grid_col):</span><span class="strut">&nbsp;</span></p>
<p id="t90" class="stm run hide_run"><span class="txt">                count += 1</span><span class="strut">&nbsp;</span></p>
<p id="t91" class="stm run hide_run"><span class="txt">                peers[level][count] = row*nsquare + i</span><span class="strut">&nbsp;</span></p>
<p id="t92" class="pln"><span class="txt">        # Peers' levels in same column, but not in grid</span><span class="strut">&nbsp;</span></p>
<p id="t93" class="stm run hide_run"><span class="txt">        for i in range(nsquare):</span><span class="strut">&nbsp;</span></p>
<p id="t94" class="stm run hide_run"><span class="txt">            if (i // 3 != grid_row):</span><span class="strut">&nbsp;</span></p>
<p id="t95" class="stm run hide_run"><span class="txt">                count += 1</span><span class="strut">&nbsp;</span></p>
<p id="t96" class="stm run hide_run"><span class="txt">                peers[level][count] = col + i*nsquare</span><span class="strut">&nbsp;</span></p>
<p id="t97" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t98" class="pln"><span class="txt">    # Initialize data structures</span><span class="strut">&nbsp;</span></p>
<p id="t99" class="pln"><span class="txt">    # Make every symbol available initially for a box</span><span class="strut">&nbsp;</span></p>
<p id="t100" class="pln"><span class="txt">    # And make set cardinality the size of symbol set</span><span class="strut">&nbsp;</span></p>
<p id="t101" class="stm run hide_run"><span class="txt">    for level in range(nboxes):</span><span class="strut">&nbsp;</span></p>
<p id="t102" class="stm run hide_run"><span class="txt">        box[level] = -1</span><span class="strut">&nbsp;</span></p>
<p id="t103" class="stm run hide_run"><span class="txt">        card[level] = nsquare</span><span class="strut">&nbsp;</span></p>
<p id="t104" class="stm run hide_run"><span class="txt">        for j in range(nsquare):</span><span class="strut">&nbsp;</span></p>
<p id="t105" class="stm run hide_run"><span class="txt">            available[level][j] = 0</span><span class="strut">&nbsp;</span></p>
<p id="t106" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t107" class="pln"><span class="txt">    # For non-zero entries of input puzzle</span><span class="strut">&nbsp;</span></p>
<p id="t108" class="pln"><span class="txt">    # (1) Convert to zero-based indexing</span><span class="strut">&nbsp;</span></p>
<p id="t109" class="pln"><span class="txt">    # (2) Make a set of size 1 available initially</span><span class="strut">&nbsp;</span></p>
<p id="t110" class="stm run hide_run"><span class="txt">    for level in range(nboxes):</span><span class="strut">&nbsp;</span></p>
<p id="t111" class="pln"><span class="txt">        # location as row and column in square</span><span class="strut">&nbsp;</span></p>
<p id="t112" class="pln"><span class="txt">        # grids are numbered similarly, in row-major order</span><span class="strut">&nbsp;</span></p>
<p id="t113" class="stm run hide_run"><span class="txt">        hint = puzzle[level] - 1</span><span class="strut">&nbsp;</span></p>
<p id="t114" class="stm run hide_run"><span class="txt">        if hint != -1:</span><span class="strut">&nbsp;</span></p>
<p id="t115" class="pln"><span class="txt">            # Limit symbol set at the hint's location to a singleton</span><span class="strut">&nbsp;</span></p>
<p id="t116" class="stm run hide_run"><span class="txt">            for j in range(nsquare):</span><span class="strut">&nbsp;</span></p>
<p id="t117" class="stm run hide_run"><span class="txt">                available[level][j] = 1</span><span class="strut">&nbsp;</span></p>
<p id="t118" class="stm run hide_run"><span class="txt">            available[level][hint] = 0</span><span class="strut">&nbsp;</span></p>
<p id="t119" class="stm run hide_run"><span class="txt">            card[level] = 1</span><span class="strut">&nbsp;</span></p>
<p id="t120" class="pln"><span class="txt">            #  Remove hint from all peers' available symbols</span><span class="strut">&nbsp;</span></p>
<p id="t121" class="pln"><span class="txt">            #  Track cardinality as sets adjust</span><span class="strut">&nbsp;</span></p>
<p id="t122" class="stm run hide_run"><span class="txt">            for i in range(npeers):</span><span class="strut">&nbsp;</span></p>
<p id="t123" class="stm run hide_run"><span class="txt">                apeer = peers[level][i]</span><span class="strut">&nbsp;</span></p>
<p id="t124" class="stm run hide_run"><span class="txt">                available[apeer][hint] += 1</span><span class="strut">&nbsp;</span></p>
<p id="t125" class="stm run hide_run"><span class="txt">                if available[apeer][hint] == 1:</span><span class="strut">&nbsp;</span></p>
<p id="t126" class="stm run hide_run"><span class="txt">                    card[apeer] -= 1</span><span class="strut">&nbsp;</span></p>
<p id="t127" class="pln"><span class="txt">&nbsp;</span><span class="strut">&nbsp;</span></p>
<p id="t128" class="pln"><span class="txt">    # Start backtracking</span><span class="strut">&nbsp;</span></p>
<p id="t129" class="stm run hide_run"><span class="txt">    solutions = []</span><span class="strut">&nbsp;</span></p>
<p id="t130" class="stm run hide_run"><span class="txt">    level = 0</span><span class="strut">&nbsp;</span></p>
<p id="t131" class="stm run hide_run"><span class="txt">    box[level] = -1</span><span class="strut">&nbsp;</span></p>
<p id="t132" class="stm run hide_run"><span class="txt">    while (level > -1):</span><span class="strut">&nbsp;</span></p>
<p id="t133" class="stm run hide_run"><span class="txt">        symbol = box[level]</span><span class="strut">&nbsp;</span></p>
<p id="t134" class="stm run hide_run"><span class="txt">        if (symbol != -1):</span><span class="strut">&nbsp;</span></p>
<p id="t135" class="pln"><span class="txt">            # restore symbols to peers</span><span class="strut">&nbsp;</span></p>
<p id="t136" class="stm run hide_run"><span class="txt">            for i in range(nfixed[level]):</span><span class="strut">&nbsp;</span></p>
<p id="t137" class="stm run hide_run"><span class="txt">                alevel = fixed[level][i]</span><span class="strut">&nbsp;</span></p>
<p id="t138" class="stm run hide_run"><span class="txt">                asymbol = fixed_symbol[level][i]</span><span class="strut">&nbsp;</span></p>
<p id="t139" class="stm run hide_run"><span class="txt">                for j in range(npeers):</span><span class="strut">&nbsp;</span></p>
<p id="t140" class="stm run hide_run"><span class="txt">                    abox = peers[alevel][j]</span><span class="strut">&nbsp;</span></p>
<p id="t141" class="stm run hide_run"><span class="txt">                    available[abox][asymbol] -= 1</span><span class="strut">&nbsp;</span></p>
<p id="t142" class="stm run hide_run"><span class="txt">                    if available[abox][asymbol] == 0:</span><span class="strut">&nbsp;</span></p>
<p id="t143" class="stm run hide_run"><span class="txt">                        card[abox] += 1</span><span class="strut">&nbsp;</span></p>
<p id="t144" class="pln"><span class="txt">        # move sideways in search tree to next available symbol</span><span class="strut">&nbsp;</span></p>
<p id="t145" class="stm run hide_run"><span class="txt">        symbol +=  1</span><span class="strut">&nbsp;</span></p>
<p id="t146" class="stm run hide_run"><span class="txt">        while (symbol &lt; nsquare) and (available[level][symbol] != 0):</span><span class="strut">&nbsp;</span></p>
<p id="t147" class="stm run hide_run"><span class="txt">            symbol += 1</span><span class="strut">&nbsp;</span></p>
<p id="t148" class="stm run hide_run"><span class="txt">        if symbol == nsquare:</span><span class="strut">&nbsp;</span></p>
<p id="t149" class="pln"><span class="txt">            # fell off the end sideways, backup</span><span class="strut">&nbsp;</span></p>
<p id="t150" class="stm run hide_run"><span class="txt">            level = level - 1</span><span class="strut">&nbsp;</span></p>
<p id="t151" class="pln"><span class="txt">        else:</span><span class="strut">&nbsp;</span></p>
<p id="t152" class="stm run hide_run"><span class="txt">            box[level] = symbol</span><span class="strut">&nbsp;</span></p>
<p id="t153" class="pln"><span class="txt">            # Remove elements of sets, adjust cardinalities</span><span class="strut">&nbsp;</span></p>
<p id="t154" class="pln"><span class="txt">            # Descend in search tree if no empty sets created</span><span class="strut">&nbsp;</span></p>
<p id="t155" class="pln"><span class="txt">            # Can't break early at an empty set</span><span class="strut">&nbsp;</span></p>
<p id="t156" class="pln"><span class="txt">            #   or we will confuse restore that happens immediately</span><span class="strut">&nbsp;</span></p>
<p id="t157" class="stm run hide_run"><span class="txt">            feasible = True</span><span class="strut">&nbsp;</span></p>
<p id="t158" class="stm run hide_run"><span class="txt">            fixed[level][0] = level</span><span class="strut">&nbsp;</span></p>
<p id="t159" class="stm run hide_run"><span class="txt">            fixed_symbol[level][0] = symbol</span><span class="strut">&nbsp;</span></p>
<p id="t160" class="stm run hide_run"><span class="txt">            count = 0</span><span class="strut">&nbsp;</span></p>
<p id="t161" class="stm run hide_run"><span class="txt">            process = -1</span><span class="strut">&nbsp;</span></p>
<p id="t162" class="stm run hide_run"><span class="txt">            while (process &lt; count) and feasible:</span><span class="strut">&nbsp;</span></p>
<p id="t163" class="stm run hide_run"><span class="txt">                process += 1</span><span class="strut">&nbsp;</span></p>
<p id="t164" class="stm run hide_run"><span class="txt">                process_level = fixed[level][process]</span><span class="strut">&nbsp;</span></p>
<p id="t165" class="stm run hide_run"><span class="txt">                process_symbol = fixed_symbol[level][process]</span><span class="strut">&nbsp;</span></p>
<p id="t166" class="stm run hide_run"><span class="txt">                for i in range(npeers):</span><span class="strut">&nbsp;</span></p>
<p id="t167" class="stm run hide_run"><span class="txt">                    abox = peers[process_level][i]</span><span class="strut">&nbsp;</span></p>
<p id="t168" class="stm run hide_run"><span class="txt">                    available[abox][process_symbol] += 1</span><span class="strut">&nbsp;</span></p>
<p id="t169" class="stm run hide_run"><span class="txt">                    if available[abox][process_symbol] == 1:</span><span class="strut">&nbsp;</span></p>
<p id="t170" class="stm run hide_run"><span class="txt">                        card[abox] -= 1</span><span class="strut">&nbsp;</span></p>
<p id="t171" class="stm run hide_run"><span class="txt">                        if card[abox] == 0:</span><span class="strut">&nbsp;</span></p>
<p id="t172" class="stm run hide_run"><span class="txt">                            feasible = False</span><span class="strut">&nbsp;</span></p>
<p id="t173" class="stm run hide_run"><span class="txt">                        if card[abox] == 1:</span><span class="strut">&nbsp;</span></p>
<p id="t174" class="stm run hide_run"><span class="txt">                            count += 1</span><span class="strut">&nbsp;</span></p>
<p id="t175" class="stm run hide_run"><span class="txt">                            fixed[level][count] = abox</span><span class="strut">&nbsp;</span></p>
<p id="t176" class="stm run hide_run"><span class="txt">                            asymbol = 0</span><span class="strut">&nbsp;</span></p>
<p id="t177" class="stm run hide_run"><span class="txt">                            while (available[abox][asymbol] != 0):</span><span class="strut">&nbsp;</span></p>
<p id="t178" class="stm run hide_run"><span class="txt">                                asymbol += 1</span><span class="strut">&nbsp;</span></p>
<p id="t179" class="stm run hide_run"><span class="txt">                            fixed_symbol[level][count] = asymbol</span><span class="strut">&nbsp;</span></p>
<p id="t180" class="stm run hide_run"><span class="txt">            nfixed[level] = process+1</span><span class="strut">&nbsp;</span></p>
<p id="t181" class="stm run hide_run"><span class="txt">            if feasible:</span><span class="strut">&nbsp;</span></p>
<p id="t182" class="stm run hide_run"><span class="txt">                if level == nboxes - 1:</span><span class="strut">&nbsp;</span></p>
<p id="t183" class="pln"><span class="txt">                    # Have a solution to save, stay at this bottom-most level</span><span class="strut">&nbsp;</span></p>
<p id="t184" class="pln"><span class="txt">                    # Once Cython implements closures, a yield can go here</span><span class="strut">&nbsp;</span></p>
<p id="t185" class="stm run hide_run"><span class="txt">                    solutions.append([box[i]+1 for i in range(nboxes)])</span><span class="strut">&nbsp;</span></p>
<p id="t186" class="pln"><span class="txt">                else:</span><span class="strut">&nbsp;</span></p>
<p id="t187" class="stm run hide_run"><span class="txt">                    level = level + 1</span><span class="strut">&nbsp;</span></p>
<p id="t188" class="stm run hide_run"><span class="txt">                    box[level] = -1</span><span class="strut">&nbsp;</span></p>
<p id="t189" class="stm run hide_run"><span class="txt">    return solutions</span><span class="strut">&nbsp;</span></p>

            </td>
        </tr>
    </table>
</div>

<div id="footer">
    <div class="content">
        <p>
            <a class="nav" href="index.html">&#xab; index</a> &nbsp; &nbsp; <a class="nav" href="https://coverage.readthedocs.io">coverage.py v4.5.1</a>,
            created at 2018-05-01 10:21
        </p>
    </div>
</div>

</body>
</html>
